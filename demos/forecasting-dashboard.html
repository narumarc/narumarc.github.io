<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Series Forecasting Dashboard - Marc V.</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .demo-container {
            max-width: 1400px;
            margin: 80px auto 40px;
            padding: 40px;
            background: rgba(15, 15, 15, 0.95);
        }
        .chart-container {
            background: rgba(26, 26, 26, 0.9);
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .metric-card {
            background: rgba(67, 233, 123, 0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #43e97b;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #43e97b;
        }
        .metric-label {
            color: #999;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: bold;
        }
        .back-link:hover {
            color: #888;
        }
        .alert-box {
            background: rgba(245, 87, 108, 0.1);
            border-left: 4px solid #f5576c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .alert-box h4 {
            color: #f5576c;
            margin: 0 0 10px 0;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .control-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        .control-btn.active {
            background: #43e97b;
        }
    </style>
</head>
<body>
    <div class="background-slider">
        <div class="background-slide bg-3 active"></div>
    </div>

    <div class="demo-container">
        <a href="../index.html#demos" class="back-link">← Back to Portfolio</a>
        
        <h1>Time Series Forecasting Dashboard</h1>
        <p style="color: #ccc; margin: 20px 0;">Advanced forecasting with confidence intervals, anomaly detection, and real-time model performance monitoring.</p>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">94.2%</div>
                <div class="metric-label">Model Accuracy</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">3.8%</div>
                <div class="metric-label">Mean Absolute Error</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">30 days</div>
                <div class="metric-label">Forecast Horizon</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">5</div>
                <div class="metric-label">Anomalies Detected</div>
            </div>
        </div>

        <div class="alert-box">
            <h4>⚠️ Anomaly Alert</h4>
            <p style="color: #ccc; margin: 0;">Detected unusual spike on Jan 15, 2025 (+28% above expected range). Potential causes: promotional campaign or data quality issue.</p>
        </div>

        <div class="controls">
            <button class="control-btn active" onclick="updateForecast('daily')">Daily Forecast</button>
            <button class="control-btn" onclick="updateForecast('weekly')">Weekly Aggregate</button>
            <button class="control-btn" onclick="updateForecast('monthly')">Monthly Trend</button>
        </div>

        <div class="chart-container">
            <h3>Sales Forecast with Confidence Intervals</h3>
            <div id="forecastChart"></div>
        </div>

        <div class="chart-container">
            <h3>Residual Analysis & Model Performance</h3>
            <div id="residualChart"></div>
        </div>

        <div class="chart-container">
            <h3>Feature Importance & Seasonality Decomposition</h3>
            <div id="seasonalityChart"></div>
        </div>
    </div>

    <script>
        // Generate time series data with trend, seasonality, and noise
        function generateForecastData() {
            const historicalDates = [];
            const historicalValues = [];
            const forecastDates = [];
            const forecastValues = [];
            const upperBound = [];
            const lowerBound = [];
            const anomalies = [];
            
            const startDate = new Date('2024-07-01');
            const forecastStart = new Date('2025-01-01');
            
            // Historical data (180 days)
            for (let i = 0; i < 180; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                historicalDates.push(date.toISOString().split('T')[0]);
                
                // Trend + Weekly seasonality + Monthly pattern + noise
                const trend = 1000 + i * 5;
                const weekly = 200 * Math.sin(i / 7 * 2 * Math.PI);
                const monthly = 150 * Math.sin(i / 30 * 2 * Math.PI);
                const noise = (Math.random() - 0.5) * 100;
                
                let value = trend + weekly + monthly + noise;
                
                // Add some anomalies
                if (i === 90 || i === 145 || i === 170) {
                    value *= 1.28; // 28% spike
                    anomalies.push({date: historicalDates[i], value: value});
                }
                
                historicalValues.push(Math.max(0, value));
            }
            
            // Forecast data (30 days)
            for (let i = 0; i < 30; i++) {
                const date = new Date(forecastStart);
                date.setDate(date.getDate() + i);
                forecastDates.push(date.toISOString().split('T')[0]);
                
                const baseDay = 180 + i;
                const trend = 1000 + baseDay * 5;
                const weekly = 200 * Math.sin(baseDay / 7 * 2 * Math.PI);
                const monthly = 150 * Math.sin(baseDay / 30 * 2 * Math.PI);
                
                const forecast = trend + weekly + monthly;
                forecastValues.push(forecast);
                
                // Confidence intervals (95%)
                const stdDev = 80 + i * 2; // Increasing uncertainty
                upperBound.push(forecast + 1.96 * stdDev);
                lowerBound.push(forecast - 1.96 * stdDev);
            }
            
            return {
                historicalDates,
                historicalValues,
                forecastDates,
                forecastValues,
                upperBound,
                lowerBound,
                anomalies
            };
        }

        const data = generateForecastData();

        // Main Forecast Chart
        const trace1 = {
            x: data.historicalDates,
            y: data.historicalValues,
            name: 'Historical Data',
            type: 'scatter',
            mode: 'lines',
            line: { color: '#667eea', width: 2 }
        };

        const trace2 = {
            x: data.forecastDates,
            y: data.forecastValues,
            name: 'Forecast',
            type: 'scatter',
            mode: 'lines',
            line: { color: '#43e97b', width: 3, dash: 'dash' }
        };

        const trace3 = {
            x: data.forecastDates,
            y: data.upperBound,
            name: 'Upper 95% CI',
            type: 'scatter',
            mode: 'lines',
            line: { width: 0 },
            showlegend: false,
            fillcolor: 'rgba(67, 233, 123, 0.2)',
            fill: 'tonexty'
        };

        const trace4 = {
            x: data.forecastDates,
            y: data.lowerBound,
            name: '95% Confidence Interval',
            type: 'scatter',
            mode: 'lines',
            line: { width: 0 },
            fillcolor: 'rgba(67, 233, 123, 0.2)',
            fill: 'tonexty'
        };

        const trace5 = {
            x: data.anomalies.map(a => a.date),
            y: data.anomalies.map(a => a.value),
            name: 'Anomalies',
            type: 'scatter',
            mode: 'markers',
            marker: { 
                color: '#f5576c', 
                size: 12,
                symbol: 'x',
                line: { width: 2 }
            }
        };

        const layout1 = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#ffffff' },
            xaxis: { 
                gridcolor: '#333',
                title: 'Date'
            },
            yaxis: { 
                title: 'Sales Volume',
                gridcolor: '#333'
            },
            legend: { x: 0.1, y: 1.1, orientation: 'h' },
            margin: { t: 40 },
            shapes: [{
                type: 'line',
                x0: '2025-01-01',
                y0: 0,
                x1: '2025-01-01',
                y1: 2500,
                line: {
                    color: '#888',
                    width: 2,
                    dash: 'dot'
                }
            }],
            annotations: [{
                x: '2025-01-01',
                y: 2400,
                text: 'Forecast Start',
                showarrow: false,
                font: { color: '#888' },
                xanchor: 'left'
            }]
        };

        Plotly.newPlot('forecastChart', [trace4, trace3, trace1, trace2, trace5], layout1, {responsive: true});

        // Residual Analysis Chart
        const residuals = data.historicalValues.map((v, i) => {
            const expected = 1000 + i * 5 + 
                           200 * Math.sin(i / 7 * 2 * Math.PI) +
                           150 * Math.sin(i / 30 * 2 * Math.PI);
            return v - expected;
        });

        const trace6 = {
            x: data.historicalDates,
            y: residuals,
            name: 'Residuals',
            type: 'scatter',
            mode: 'markers',
            marker: { 
                color: residuals.map(r => Math.abs(r) > 150 ? '#f5576c' : '#4facfe'),
                size: 6
            }
        };

        const trace7 = {
            x: data.historicalDates,
            y: Array(data.historicalDates.length).fill(0),
            name: 'Zero Line',
            type: 'scatter',
            mode: 'lines',
            line: { color: '#888', width: 1, dash: 'dash' },
            showlegend: false
        };

        const layout2 = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#ffffff' },
            xaxis: { 
                gridcolor: '#333',
                title: 'Date'
            },
            yaxis: { 
                title: 'Residual Value',
                gridcolor: '#333'
            },
            margin: { t: 40 }
        };

        Plotly.newPlot('residualChart', [trace7, trace6], layout2, {responsive: true});

        // Seasonality Decomposition
        const features = ['Trend', 'Weekly Pattern', 'Monthly Pattern', 'Holidays', 'Promotions'];
        const importance = [0.45, 0.25, 0.15, 0.08, 0.07];

        const trace8 = {
            x: features,
            y: importance,
            type: 'bar',
            marker: { 
                color: ['#667eea', '#43e97b', '#4facfe', '#fa709a', '#f5576c']
            },
            text: importance.map(v => (v * 100).toFixed(1) + '%'),
            textposition: 'outside'
        };

        const layout3 = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#ffffff' },
            xaxis: { 
                gridcolor: '#333',
                title: 'Feature'
            },
            yaxis: { 
                title: 'Importance Score',
                gridcolor: '#333',
                tickformat: '.0%'
            },
            margin: { t: 40 }
        };

        Plotly.newPlot('seasonalityChart', [trace8], layout3, {responsive: true});

        // Update forecast function (placeholder for interactivity)
        function updateForecast(mode) {
            // Remove active class from all buttons
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // In a real implementation, this would reload data with different aggregation
            console.log('Updating forecast to:', mode);
        }
    </script>
</body>
</html>
