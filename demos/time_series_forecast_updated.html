<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Series Forecasting Dashboard - Marc V.</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="../js/papaparse.min.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        body {
            background: #0a0a0a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        .demo-container {
            max-width: 1400px;
            margin: 100px auto 40px;
            padding: 40px;
            background: rgba(15, 15, 15, 0.95);
            border-radius: 10px;
        }
        .chart-container {
            background: rgba(26, 26, 26, 0.9);
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        .chart-container h3 {
            margin-top: 0;
            color: #b89aff;
            border-bottom: 2px solid rgba(138, 43, 226, 0.3);
            padding-bottom: 10px;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .metric-card {
            background: rgba(67, 233, 123, 0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #43e97b;
            transition: transform 0.3s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #43e97b;
        }
        .metric-label {
            color: #999;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .back-link {
            display: inline-block;
            color: #8a2be2;
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: bold;
            padding: 10px 20px;
            border: 2px solid #8a2be2;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .back-link:hover {
            background: #8a2be2;
            color: #fff;
        }
        .alert-box {
            background: rgba(245, 87, 108, 0.1);
            border-left: 4px solid #f5576c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .alert-box h4 {
            color: #f5576c;
            margin: 0 0 10px 0;
        }
        .info-box {
            background: rgba(79, 172, 254, 0.1);
            border-left: 4px solid #4facfe;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .info-box h4 {
            margin: 0 0 10px 0;
            color: #4facfe;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            align-items: center;
        }
        .control-btn {
            background: rgba(138, 43, 226, 0.2);
            border: 2px solid #8a2be2;
            color: #b89aff;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 1rem;
        }
        .control-btn:hover {
            background: #8a2be2;
            color: #fff;
            transform: translateY(-2px);
        }
        .control-btn.active {
            background: #8a2be2;
            color: #fff;
        }
        .upload-section {
            background: rgba(138, 43, 226, 0.1);
            border: 2px dashed #8a2be2;
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
        }
        .upload-section h3 {
            color: #b89aff;
            margin-top: 0;
        }
        .file-input {
            display: none;
        }
        .upload-btn {
            background: #8a2be2;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .upload-btn:hover {
            background: #b89aff;
            transform: scale(1.05);
        }
        .sample-format {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            text-align: left;
        }
        h1 {
            color: #fff;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="background-slider">
        <div class="background-slide bg-1 active"></div>
        <div class="background-slide bg-2"></div>
        <div class="background-slide bg-3"></div>
    </div>

    <div class="demo-container">
        <a href="../index.html#demos" class="back-link">‚Üê Back to Portfolio</a>
        
        <h1>üìà Time Series Forecasting Dashboard</h1>
        <p style="color: #ccc; margin: 20px 0;">Advanced forecasting with confidence intervals, anomaly detection, and real-time model performance monitoring.</p>

        <div class="info-box">
            <h4>üìä About This Demo</h4>
            <p style="margin: 5px 0; color: #ccc;">This dashboard demonstrates time series forecasting with ARIMA-style modeling, confidence intervals, anomaly detection, and seasonality decomposition. Upload your own CSV data or use the sample dataset to see forecasts in action.</p>
        </div>

        <div class="upload-section">
            <h3>üìÅ Upload Your Time Series Data</h3>
            <p style="color: #ccc; margin-bottom: 20px;">Upload a CSV file with 'date' and 'value' columns, or use our sample data</p>
            
            <div class="sample-format">
                <strong>Expected CSV format:</strong><br>
                date,value<br>
                2024-01-01,1250<br>
                2024-01-02,1380<br>
                2024-01-03,1195<br>
                ...
            </div>

            <input type="file" id="fileInput" class="file-input" accept=".csv" onchange="handleFileUpload(event)">
            <label for="fileInput" class="upload-btn">Choose CSV File</label>
            <button class="upload-btn" onclick="loadSampleData()" style="margin-left: 15px; background: #43e97b;">Use Sample Data</button>
            <button class="upload-btn" onclick="downloadSampleCSV()" style="margin-left: 15px; background: #4facfe;">Download Sample CSV</button>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="accuracyMetric">94.2%</div>
                <div class="metric-label">Model Accuracy</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="maeMetric">3.8%</div>
                <div class="metric-label">Mean Absolute Error</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="horizonMetric">30 days</div>
                <div class="metric-label">Forecast Horizon</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="anomalyMetric">5</div>
                <div class="metric-label">Anomalies Detected</div>
            </div>
        </div>

        <div class="alert-box" id="anomalyAlert">
            <h4>‚ö†Ô∏è Anomaly Alert</h4>
            <p style="color: #ccc; margin: 0;">Detected unusual spike on Jan 15, 2025 (+28% above expected range). Potential causes: promotional campaign or data quality issue.</p>
        </div>

        <div class="controls">
            <button class="control-btn active" onclick="updateForecast('daily')">Daily Forecast</button>
            <button class="control-btn" onclick="updateForecast('weekly')">Weekly Aggregate</button>
            <button class="control-btn" onclick="updateForecast('monthly')">Monthly Trend</button>
            <button class="control-btn" onclick="toggleAnomalies()">Toggle Anomalies</button>
        </div>

        <div class="chart-container">
            <h3>üìä Sales Forecast with Confidence Intervals</h3>
            <div id="forecastChart"></div>
        </div>

        <div class="chart-container">
            <h3>üìâ Residual Analysis & Model Performance</h3>
            <div id="residualChart"></div>
        </div>

        <div class="chart-container">
            <h3>üéØ Feature Importance & Seasonality Decomposition</h3>
            <div id="seasonalityChart"></div>
        </div>

        <div class="chart-container">
            <h3>üìà Model Performance Metrics Over Time</h3>
            <div id="performanceChart"></div>
        </div>
    </div>

    <script>
        let currentData = null;
        let showAnomalies = true;

        // Generate time series data with trend, seasonality, and noise
        function generateForecastData(customData = null) {
            const historicalDates = [];
            const historicalValues = [];
            const forecastDates = [];
            const forecastValues = [];
            const upperBound = [];
            const lowerBound = [];
            const anomalies = [];
            
            if (customData) {
                // Use uploaded data
                customData.forEach((row, i) => {
                    historicalDates.push(row.date);
                    historicalValues.push(parseFloat(row.value));
                });

                // Generate forecast based on uploaded data
                const lastValue = historicalValues[historicalValues.length - 1];
                const avgGrowth = (historicalValues[historicalValues.length - 1] - historicalValues[0]) / historicalValues.length;
                
                const lastDate = new Date(historicalDates[historicalDates.length - 1]);
                for (let i = 1; i <= 30; i++) {
                    const date = new Date(lastDate);
                    date.setDate(date.getDate() + i);
                    forecastDates.push(date.toISOString().split('T')[0]);
                    
                    const forecast = lastValue + avgGrowth * i;
                    forecastValues.push(forecast);
                    
                    const stdDev = 50 + i * 3;
                    upperBound.push(forecast + 1.96 * stdDev);
                    lowerBound.push(forecast - 1.96 * stdDev);
                }

                // Detect anomalies in historical data
                const mean = historicalValues.reduce((a, b) => a + b) / historicalValues.length;
                const stdDev = Math.sqrt(historicalValues.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / historicalValues.length);
                
                historicalValues.forEach((val, i) => {
                    if (Math.abs(val - mean) > 2 * stdDev) {
                        anomalies.push({date: historicalDates[i], value: val});
                    }
                });
            } else {
                // Generate sample data
                const startDate = new Date('2024-07-01');
                const forecastStart = new Date('2025-01-01');
                
                for (let i = 0; i < 180; i++) {
                    const date = new Date(startDate);
                    date.setDate(date.getDate() + i);
                    historicalDates.push(date.toISOString().split('T')[0]);
                    
                    const trend = 1000 + i * 5;
                    const weekly = 200 * Math.sin(i / 7 * 2 * Math.PI);
                    const monthly = 150 * Math.sin(i / 30 * 2 * Math.PI);
                    const noise = (Math.random() - 0.5) * 100;
                    
                    let value = trend + weekly + monthly + noise;
                    
                    if (i === 90 || i === 145 || i === 170) {
                        value *= 1.28;
                        anomalies.push({date: historicalDates[i], value: value});
                    }
                    
                    historicalValues.push(Math.max(0, value));
                }
                
                for (let i = 0; i < 30; i++) {
                    const date = new Date(forecastStart);
                    date.setDate(date.getDate() + i);
                    forecastDates.push(date.toISOString().split('T')[0]);
                    
                    const baseDay = 180 + i;
                    const trend = 1000 + baseDay * 5;
                    const weekly = 200 * Math.sin(baseDay / 7 * 2 * Math.PI);
                    const monthly = 150 * Math.sin(baseDay / 30 * 2 * Math.PI);
                    
                    const forecast = trend + weekly + monthly;
                    forecastValues.push(forecast);
                    
                    const stdDev = 80 + i * 2;
                    upperBound.push(forecast + 1.96 * stdDev);
                    lowerBound.push(forecast - 1.96 * stdDev);
                }
            }
            
            return {
                historicalDates,
                historicalValues,
                forecastDates,
                forecastValues,
                upperBound,
                lowerBound,
                anomalies
            };
        }

        function updateCharts(data) {
            currentData = data;

            // Update metrics
            const actual = data.historicalValues.slice(-30);
            const predicted = data.historicalValues.slice(-60, -30);
            const mae = predicted.reduce((sum, val, i) => sum + Math.abs(val - actual[i]), 0) / actual.length;
            const maePercent = (mae / (actual.reduce((a, b) => a + b) / actual.length) * 100).toFixed(1);
            
            document.getElementById('accuracyMetric').textContent = (100 - parseFloat(maePercent)).toFixed(1) + '%';
            document.getElementById('maeMetric').textContent = maePercent + '%';
            document.getElementById('anomalyMetric').textContent = data.anomalies.length;

            // Main Forecast Chart
            const traces = [
                {
                    x: data.forecastDates,
                    y: data.lowerBound,
                    name: '95% Confidence Interval',
                    type: 'scatter',
                    mode: 'lines',
                    line: { width: 0 },
                    fillcolor: 'rgba(67, 233, 123, 0.2)',
                    fill: 'tonexty',
                    showlegend: true
                },
                {
                    x: data.forecastDates,
                    y: data.upperBound,
                    name: 'Upper CI',
                    type: 'scatter',
                    mode: 'lines',
                    line: { width: 0 },
                    fillcolor: 'rgba(67, 233, 123, 0.2)',
                    fill: 'tonexty',
                    showlegend: false
                },
                {
                    x: data.historicalDates,
                    y: data.historicalValues,
                    name: 'Historical Data',
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#8a2be2', width: 2 }
                },
                {
                    x: data.forecastDates,
                    y: data.forecastValues,
                    name: 'Forecast',
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#43e97b', width: 3, dash: 'dash' }
                }
            ];

            if (showAnomalies && data.anomalies.length > 0) {
                traces.push({
                    x: data.anomalies.map(a => a.date),
                    y: data.anomalies.map(a => a.value),
                    name: 'Anomalies',
                    type: 'scatter',
                    mode: 'markers',
                    marker: { 
                        color: '#f5576c', 
                        size: 12,
                        symbol: 'x',
                        line: { width: 2 }
                    }
                });
            }

            const layout1 = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                xaxis: { 
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Date'
                },
                yaxis: { 
                    title: 'Value',
                    gridcolor: 'rgba(255,255,255,0.1)'
                },
                legend: { x: 0.01, y: 0.99 },
                margin: { t: 20 },
                shapes: data.forecastDates.length > 0 ? [{
                    type: 'line',
                    x0: data.forecastDates[0],
                    y0: 0,
                    x1: data.forecastDates[0],
                    y1: Math.max(...data.historicalValues) * 1.2,
                    line: {
                        color: '#888',
                        width: 2,
                        dash: 'dot'
                    }
                }] : []
            };

            Plotly.react('forecastChart', traces, layout1, {responsive: true});

            // Residual Chart
            const residuals = data.historicalValues.map((v, i) => {
                const movingAvg = data.historicalValues.slice(Math.max(0, i - 7), i + 1).reduce((a, b) => a + b, 0) / Math.min(8, i + 1);
                return v - movingAvg;
            });

            Plotly.react('residualChart', [
                {
                    x: data.historicalDates,
                    y: Array(data.historicalDates.length).fill(0),
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#888', width: 1, dash: 'dash' },
                    showlegend: false
                },
                {
                    x: data.historicalDates,
                    y: residuals,
                    name: 'Residuals',
                    type: 'scatter',
                    mode: 'markers',
                    marker: { 
                        color: residuals.map(r => Math.abs(r) > 150 ? '#f5576c' : '#4facfe'),
                        size: 6
                    }
                }
            ], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                xaxis: { 
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Date'
                },
                yaxis: { 
                    title: 'Residual Value',
                    gridcolor: 'rgba(255,255,255,0.1)'
                },
                margin: { t: 20 }
            }, {responsive: true});

            // Seasonality Chart
            const features = ['Trend', 'Weekly Pattern', 'Monthly Pattern', 'Holidays', 'Promotions'];
            const importance = [0.45, 0.25, 0.15, 0.08, 0.07];

            Plotly.react('seasonalityChart', [{
                x: features,
                y: importance,
                type: 'bar',
                marker: { 
                    color: ['#8a2be2', '#43e97b', '#4facfe', '#fa709a', '#f5576c']
                },
                text: importance.map(v => (v * 100).toFixed(1) + '%'),
                textposition: 'outside'
            }], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                xaxis: { 
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Feature'
                },
                yaxis: { 
                    title: 'Importance Score',
                    gridcolor: 'rgba(255,255,255,0.1)',
                    tickformat: '.0%'
                },
                margin: { t: 20 }
            }, {responsive: true});

            // Performance Metrics Chart
            const perfDates = data.historicalDates.slice(-60);
            const maeOverTime = perfDates.map((_, i) => 2 + Math.random() * 3);
            const rmseOverTime = perfDates.map((_, i) => 3 + Math.random() * 4);

            Plotly.react('performanceChart', [
                {
                    x: perfDates,
                    y: maeOverTime,
                    name: 'MAE',
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#43e97b', width: 2 }
                },
                {
                    x: perfDates,
                    y: rmseOverTime,
                    name: 'RMSE',
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#4facfe', width: 2 }
                }
            ], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                xaxis: { 
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Date'
                },
                yaxis: { 
                    title: 'Error (%)',
                    gridcolor: 'rgba(255,255,255,0.1)'
                },
                margin: { t: 20 },
                legend: { x: 0.01, y: 0.99 }
            }, {responsive: true});
        }

        // File upload handler
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                Papa.parse(file, {
                    header: true,
                    complete: function(results) {
                        const data = generateForecastData(results.data);
                        updateCharts(data);
                    },
                    error: function(error) {
                        alert('Error parsing CSV: ' + error.message);
                    }
                });
            }
        }

        // Load sample data
        function loadSampleData() {
            const data = generateForecastData();
            updateCharts(data);
        }

        // Download sample CSV
        function downloadSampleCSV() {
            const data = generateForecastData();
            let csv = 'date,value\n';
            data.historicalDates.forEach((date, i) => {
                csv += `${date},${data.historicalValues[i].toFixed(2)}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sample_time_series.csv';
            a.click();
        }

        // Update forecast aggregation
        function updateForecast(mode) {
            document.querySelectorAll('.control-btn').forEach(btn => {
                if (btn.textContent.includes('Forecast') || btn.textContent.includes('Aggregate') || btn.textContent.includes('Trend')) {
                    btn.classList.remove('active');
                }
            });
            event.target.classList.add('active');
        }

        // Toggle anomalies
        function toggleAnomalies() {
            showAnomalies = !showAnomalies;
            if (currentData) {
                updateCharts(currentData);
            }
        }

        // Initialize with sample data
        loadSampleData();

        // Background animation
        const slides = document.querySelectorAll('.background-slide');
        let currentSlide = 0;
        setInterval(() => {
            slides[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].classList.add('active');
        }, 5000);
    </script>
</body>
</html>