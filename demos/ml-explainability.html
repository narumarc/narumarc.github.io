<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Model Explainability - Marc V.</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .demo-container {
            max-width: 1400px;
            margin: 80px auto 40px;
            padding: 40px;
            background: rgba(15, 15, 15, 0.95);
        }
        .chart-container {
            background: rgba(26, 26, 26, 0.9);
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .metric-card {
            background: rgba(118, 75, 162, 0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #764ba2;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #764ba2;
        }
        .metric-label {
            color: #999;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: bold;
        }
        .back-link:hover {
            color: #888;
        }
        .prediction-box {
            background: rgba(26, 26, 26, 0.9);
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #667eea;
            margin: 20px 0;
        }
        .prediction-result {
            font-size: 2.5rem;
            font-weight: bold;
            color: #43e97b;
            margin: 10px 0;
        }
        .upload-section {
            background: rgba(26, 26, 26, 0.9);
            padding: 30px;
            border-radius: 10px;
            border: 2px dashed rgba(102, 126, 234, 0.5);
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-section:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        .upload-section input {
            display: none;
        }
        .feature-importance-list {
            list-style: none;
            padding: 0;
        }
        .feature-importance-list li {
            padding: 10px;
            margin: 5px 0;
            background: rgba(26, 26, 26, 0.5);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .feature-bar {
            height: 8px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            margin-top: 5px;
        }
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .input-group label {
            color: #999;
            font-size: 0.9rem;
        }
        .input-group input, .input-group select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(26, 26, 26, 0.9);
            color: white;
            font-size: 1rem;
        }
        .predict-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .predict-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="background-slider">
        <div class="background-slide bg-2 active"></div>
    </div>

    <div class="demo-container">
        <a href="../index.html#demos" class="back-link">‚Üê Back to Portfolio</a>
        
        <h1>ML Model Explainability Dashboard</h1>
        <p style="color: #ccc; margin: 20px 0;">Interactive model interpretation with SHAP values, feature importance, and prediction explanations for transparent AI decision-making.</p>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">94.3%</div>
                <div class="metric-label">Model Accuracy</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">0.89</div>
                <div class="metric-label">AUC-ROC Score</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">12</div>
                <div class="metric-label">Input Features</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">15ms</div>
                <div class="metric-label">Avg Inference Time</div>
            </div>
        </div>

        <div class="chart-container">
            <h3>Upload CSV Data for Prediction</h3>
            <div class="upload-section" onclick="document.getElementById('csvUpload').click()">
                <input type="file" id="csvUpload" accept=".csv" onchange="handleCSVUpload(event)">
                <div style="font-size: 3rem; margin-bottom: 10px;">üìÅ</div>
                <h4>Click to Upload CSV File</h4>
                <p style="color: #999; margin: 10px 0;">Accepted format: CSV with features (age, income, credit_score, etc.)</p>
                <p id="uploadStatus" style="color: #43e97b; margin-top: 10px;"></p>
            </div>
        </div>

        <div class="chart-container">
            <h3>Single Prediction Input</h3>
            <div class="control-panel">
                <div class="input-group">
                    <label>Age</label>
                    <input type="number" id="age" value="35" min="18" max="100">
                </div>
                <div class="input-group">
                    <label>Income ($)</label>
                    <input type="number" id="income" value="75000" min="0">
                </div>
                <div class="input-group">
                    <label>Credit Score</label>
                    <input type="number" id="creditScore" value="720" min="300" max="850">
                </div>
                <div class="input-group">
                    <label>Employment Years</label>
                    <input type="number" id="employment" value="5" min="0">
                </div>
                <div class="input-group">
                    <label>Debt-to-Income Ratio</label>
                    <input type="number" id="dti" value="0.25" step="0.01" min="0" max="1">
                </div>
                <div class="input-group">
                    <label>Loan Amount ($)</label>
                    <input type="number" id="loanAmount" value="25000" min="0">
                </div>
            </div>
            <button class="predict-btn" onclick="makePrediction()">üîÆ Generate Prediction & Explanation</button>
            
            <div class="prediction-box" id="predictionResult" style="display: none;">
                <h4>Prediction Result</h4>
                <div class="prediction-result" id="predictionValue"></div>
                <p style="color: #ccc;" id="predictionConfidence"></p>
            </div>
        </div>

        <div class="chart-container">
            <h3>Global Feature Importance (Random Forest Model)</h3>
            <div id="featureImportanceChart"></div>
        </div>

        <div class="chart-container">
            <h3>SHAP Values - Individual Prediction Explanation</h3>
            <div id="shapChart"></div>
        </div>

        <div class="chart-container">
            <h3>Partial Dependence Plot</h3>
            <div id="pdpChart"></div>
        </div>

        <div class="chart-container">
            <h3>Confusion Matrix</h3>
            <div id="confusionMatrix"></div>
        </div>
    </div>

    <script>
        let uploadedData = null;

        // Handle CSV Upload
        async function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const rows = text.split('\\n').map(row => row.split(','));
                uploadedData = rows;
                
                document.getElementById('uploadStatus').textContent = 
                    \`‚úÖ Successfully loaded \${rows.length - 1} records from \${file.name}\`;
                
                // Process and display predictions for all rows
                console.log('CSV data loaded:', uploadedData);
            };
            reader.readAsText(file);
        }

        // Make Prediction
        function makePrediction() {
            const age = parseFloat(document.getElementById('age').value);
            const income = parseFloat(document.getElementById('income').value);
            const creditScore = parseFloat(document.getElementById('creditScore').value);
            const employment = parseFloat(document.getElementById('employment').value);
            const dti = parseFloat(document.getElementById('dti').value);
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);

            // Simple scoring logic (simulate ML model)
            let score = 0;
            score += (creditScore - 300) / 550 * 40; // 0-40 points
            score += Math.min(income / 100000, 1) * 25; // 0-25 points
            score += Math.min(employment / 10, 1) * 15; // 0-15 points
            score += (1 - dti) * 20; // 0-20 points

            const probability = score / 100;
            const approved = probability > 0.6;

            // Display result
            document.getElementById('predictionResult').style.display = 'block';
            document.getElementById('predictionValue').textContent = 
                approved ? '‚úÖ APPROVED' : '‚ùå DENIED';
            document.getElementById('predictionValue').style.color = 
                approved ? '#43e97b' : '#f5576c';
            document.getElementById('predictionConfidence').textContent = 
                \`Confidence: \${(probability * 100).toFixed(1)}%\`;

            // Update SHAP chart with current values
            updateSHAPChart(age, income, creditScore, employment, dti, loanAmount);
        }

        // Update SHAP Chart
        function updateSHAPChart(age, income, creditScore, employment, dti, loanAmount) {
            const features = ['Credit Score', 'Income', 'DTI Ratio', 'Employment Years', 'Age', 'Loan Amount'];
            
            // Calculate SHAP values (simplified)
            const shapValues = [
                (creditScore - 650) / 200 * 0.3,
                (income - 50000) / 100000 * 0.25,
                -(dti - 0.3) * 0.4,
                (employment - 3) / 10 * 0.15,
                (age - 40) / 50 * 0.1,
                -(loanAmount - 20000) / 50000 * 0.2
            ];

            const colors = shapValues.map(v => v > 0 ? '#43e97b' : '#f5576c');

            const trace = {
                y: features,
                x: shapValues,
                type: 'bar',
                orientation: 'h',
                marker: { color: colors },
                text: shapValues.map(v => v.toFixed(3)),
                textposition: 'outside'
            };

            const layout = {
                title: 'Impact on Prediction (SHAP Values)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#ffffff' },
                xaxis: { 
                    gridcolor: '#333',
                    title: 'Impact on Prediction',
                    zeroline: true,
                    zerolinecolor: '#666',
                    zerolinewidth: 2
                },
                yaxis: { gridcolor: '#333' },
                margin: { l: 150, t: 60 }
            };

            Plotly.newPlot('shapChart', [trace], layout, {responsive: true});
        }

        // Feature Importance Chart
        const features = ['Credit Score', 'Income', 'DTI Ratio', 'Employment Years', 'Loan Amount', 'Age', 
                         'Previous Loans', 'Account Age', 'Payment History', 'Inquiries', 'Utilization', 'Assets'];
        const importance = [0.28, 0.22, 0.15, 0.12, 0.08, 0.06, 0.04, 0.02, 0.01, 0.01, 0.005, 0.005];

        const trace1 = {
            y: features,
            x: importance,
            type: 'bar',
            orientation: 'h',
            marker: { 
                color: importance,
                colorscale: [[0, '#764ba2'], [1, '#667eea']],
                showscale: false
            },
            text: importance.map(i => (i * 100).toFixed(1) + '%'),
            textposition: 'outside'
        };

        const layout1 = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#ffffff' },
            xaxis: { 
                gridcolor: '#333',
                title: 'Importance Score',
                tickformat: '.0%'
            },
            yaxis: { gridcolor: '#333' },
            margin: { l: 150, t: 40 }
        };

        Plotly.newPlot('featureImportanceChart', [trace1], layout1, {responsive: true});

        // Partial Dependence Plot
        const creditScores = [];
        const pdpValues = [];
        for (let cs = 300; cs <= 850; cs += 10) {
            creditScores.push(cs);
            // Sigmoid-like relationship
            pdpValues.push(1 / (1 + Math.exp(-(cs - 650) / 50)));
        }

        const trace2 = {
            x: creditScores,
            y: pdpValues,
            type: 'scatter',
            mode: 'lines',
            line: { color: '#667eea', width: 3 },
            fill: 'tozeroy',
            fillcolor: 'rgba(102, 126, 234, 0.2)'
        };

        const layout2 = {
            title: 'Credit Score Impact on Approval Probability',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#ffffff' },
            xaxis: { 
                gridcolor: '#333',
                title: 'Credit Score'
            },
            yaxis: { 
                gridcolor: '#333',
                title: 'Predicted Probability',
                tickformat: '.0%'
            },
            margin: { t: 60 }
        };

        Plotly.newPlot('pdpChart', [trace2], layout2, {responsive: true});

        // Confusion Matrix
        const confusionData = [[850, 45], [62, 943]];
        const trace3 = {
            z: confusionData,
            x: ['Predicted: Denied', 'Predicted: Approved'],
            y: ['Actual: Denied', 'Actual: Approved'],
            type: 'heatmap',
            colorscale: [
                [0, '#f5576c'],
                [0.5, '#fa709a'],
                [1, '#43e97b']
            ],
            text: confusionData,
            texttemplate: '%{text}',
            textfont: { size: 20, color: 'white' },
            showscale: false
        };

        const layout3 = {
            title: 'Model Performance - Confusion Matrix',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#ffffff' },
            xaxis: { side: 'bottom' },
            yaxis: { autorange: 'reversed' },
            margin: { t: 60 }
        };

        Plotly.newPlot('confusionMatrix', [trace3], layout3, {responsive: true});

        // Initialize with default prediction
        makePrediction();
    </script>
</body>
</html>`
